import{s as y}from"./client-CGC07Of8.js";window.isSwitchingTab=!1;window.isLoadingPlaylistDetail=!1;window.loadDetailPlaylist=async function(e){var r;if(!e){console.error("L·ªói: Thi·∫øu ID playlist");return}if(window.isLoadingPlaylistDetail){console.log("ƒêang t·∫£i playlist, b·ªè qua request tr√πng");return}window.isLoadingPlaylistDetail=!0,window.currentPlaylistId=e;const t=document.getElementById("playlistHeader"),n=document.getElementById("trackList");t&&(t.innerHTML="<p>ƒêang t·∫£i playlist...</p>"),n&&(n.innerHTML="<p>ƒêang t·∫£i b√†i h√°t...</p>");try{const{data:o,error:s}=await y.from("playlists").select("*").eq("id",e).single();if(s)throw s;if(!o)throw new Error("Playlist kh√¥ng t·ªìn t·∫°i");if(window.currentEditingPlaylist=o,t){t.innerHTML=`
                <div class="playlist-info">
                    <h1>${h(o.name)}</h1>
                    <p>${h(o.description||"Kh√¥ng c√≥ m√¥ t·∫£")}</p>
                </div>
                <div class="playlist-actions">
                    <button class="play-all-btn" data-id="${e}">Ph√°t T·∫•t C·∫£</button>
                    <button class="edit-playlist-btn" onclick="window.toggleEditPlaylist('${e}', '${h(o.name)}', '${h(o.description||"")}', '${o.color||""}', '${o.cover_url||""}')">
                        Ch·ªânh s·ª≠a
                    </button>
                    <button class="delete-playlist-btn" onclick="window.deletePlaylist('${e}')" style="background:#ff4d4d;color:white;padding:8px 16px;border:none;border-radius:4px;margin-left:10px;">
                        X√≥a
                    </button>
                </div>
                <form id="editPlaylistForm-${e}" class="edit-form" style="display:none;">
                    <input type="text" id="editName-${e}" value="${h(o.name)}" required>
                    <input type="text" id="editDesc-${e}" value="${h(o.description||"")}">
                    <div style="display:flex;gap:10px;align-items:center;">
                        <label>M√†u:</label>
                        <input type="color" id="editColor-${e}" value="${o.color||"#1db954"}">
                    </div>
                    <div class="cover-section">
                        <label for="editCover-${e}">·∫¢nh n·ªÅn:</label>
                        <input type="file" id="editCover-${e}" accept="image/*">
                        ${o.cover_url?`<img src="${P(o.cover_url)}" style="width:60px;height:60px;object-fit:cover;margin-top:5px;border-radius:4px;">
                            <button type="button" onclick="window.deletePlaylistCover('${e}')">X√≥a ·∫£nh</button>`:""}
                    </div>
                    <div class="edit-actions">
                        <button type="button" class="btn-save" onclick="window.savePlaylistEdit('${e}')">L∆∞u</button>
                        <button type="button" class="btn-cancel" onclick="window.toggleEditPlaylist('${e}')">H·ªßy</button>
                    </div>
                </form>
            `;const i=t.querySelector(".play-all-btn");i&&i.addEventListener("click",()=>U(e,o))}const l=await window.loadPlaylistTracks(e,!1);n&&(l.length===0?n.innerHTML='<p class="empty-message">Playlist tr·ªëng</p>':$(l,n));const a=document.createElement("span");a.textContent=`${l.length} b√†i h√°t`,a.style.cssText="color:var(--text-secondary);font-size:0.9em;margin-left:10px;",(r=t.querySelector(".playlist-info"))==null||r.appendChild(a)}catch(o){console.error("L·ªói load playlist:",o),n&&(n.innerHTML=`<p class="error">L·ªói: ${o.message}</p>`),t&&(t.innerHTML="<h2>L·ªói t·∫£i</h2>")}finally{window.isLoadingPlaylistDetail=!1}};async function M(e,t,n){const r="cover",o=n.name.split(".").pop(),s=`playlists/${t}/cover.${o}`;try{console.log("Starting playlist cover upload to path:",s);const{data:l,error:a}=await y.storage.from(r).upload(s,n,{cacheControl:"3600",upsert:!0});if(a)return console.error("Upload error:",a),null;const{data:i}=y.storage.from(r).getPublicUrl(s);return console.log("Public URL:",i.publicUrl),i.publicUrl}catch(l){return console.error("System error during upload:",l),null}}window.uploadPlaylistCover=M;function U(e,t){window.loadPlaylistTracks(e,!1).then(n=>{n.length>0&&(window.currentPlaylist=n,window.currentTrackIndex=0,window.playTrack(n[0],n,0),console.log(`Playing all from playlist: ${t.name}`))})}window.toggleEditPlaylist=function(e,t,n,r,o=null){const s=`editPlaylistForm-${e}`,l=document.getElementById(s),a=document.querySelector(`.edit-playlist-btn[onclick*="toggleEditPlaylist('${e}'"]`);if(!l||!a)return console.error("Kh√¥ng t√¨m th·∫•y form/edit btn");if(l.classList.contains("active"))l.classList.remove("active"),a.textContent="Ch·ªânh s·ª≠a";else{document.getElementById(`editName-${e}`).value=t||"",document.getElementById(`editDesc-${e}`).value=n||"",document.getElementById(`editColor-${e}`).value=r||"#1db954",l.classList.add("active"),a.textContent="H·ªßy";let i=l.querySelector(".cover-section");i||(i=document.createElement("div"),i.className="cover-section",i.innerHTML=`
                <label for="editCover-${e}">·∫¢nh n·ªÅn (t√πy ch·ªçn):</label>
                <input type="file" id="editCover-${e}" accept="image/*">
                ${o?`<img src="${P(o)}" alt="Current Cover" style="width: 60px; height: 60px; object-fit: cover; margin-top: 5px; border-radius: 4px;"><button type="button" class="btn-delete-cover" onclick="window.deletePlaylistCover('${e}')">X√≥a ·∫£nh</button>`:""}
            `,l.appendChild(i))}};function P(e){if(!e)return null;if(e.includes("supabase.co")||e.startsWith("http"))return e;const{data:t}=y.storage.from("cover").getPublicUrl(e);return t.publicUrl}window.savePlaylistEdit=async function(e){var d;const t=`editPlaylistForm-${e}`;if(!document.getElementById(t))return console.error("Form kh√¥ng t·ªìn t·∫°i");const r=document.getElementById(`editName-${e}`).value.trim(),o=document.getElementById(`editDesc-${e}`).value.trim(),s=document.getElementById(`editColor-${e}`).value,l=(d=document.getElementById(`editCover-${e}`))==null?void 0:d.files[0];if(!r){alert("T√™n playlist kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!");return}let i=window.currentEditingPlaylist.cover_url||null;if(l){const{data:{user:c}}=await y.auth.getUser(),m=await window.uploadPlaylistCover(c.id,e,l);m&&(i=m)}else document.querySelector(`#editCover-${e} + .btn-delete-cover`)&&(i=null);const w={name:r,description:o,color:s,cover_url:i};try{const{error:c}=await y.from("playlists").update(w).eq("id",e).select();if(c)throw c;console.log("Playlist updated:",w),alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!"),window.toggleEditPlaylist(e,r,o,s,i),await window.loadDetailPlaylist(e),await window.appFunctions.loadUserPlaylists(!0)}catch(c){console.error("L·ªói update playlist:",c),alert(`L·ªói: ${c.message}. Ki·ªÉm tra quy·ªÅn RLS n·∫øu c·∫ßn.`)}};window.deletePlaylistCover=async function(e){if(confirm("X√≥a ·∫£nh n·ªÅn playlist?"))try{const{error:t}=await y.from("playlists").update({cover_url:null}).eq("id",e);if(t)throw t;console.log("Cover deleted"),await window.appFunctions.loadUserPlaylists(!0),await window.loadDetailPlaylist(e)}catch(t){console.error("L·ªói x√≥a cover:",t),alert("L·ªói: "+t.message)}};function $(e,t){t&&(t.innerHTML="",e.forEach((n,r)=>{const o=document.createElement("div");o.className="track-item playable-track";const s=n.title?n.title.trim():"Unknown Title",l=n.artist?n.artist.trim():"Unknown Artist",a=n.cover_url||"",i=r+1;o.addEventListener("click",function(u){u.target.closest(".btn-action")||(window.currentPlaylist=e,window.playTrack(n,e,r),u.preventDefault())});const w=s.length>20?`${s}`:s,c=t.id==="trackList"?`
            <div class="track-actions">
                <button class="btn-action btn-remove-track" onclick="window.removeTrackFromPlaylist('${n.id}', '${window.currentPlaylistId||""}')" title="X√≥a kh·ªèi playlist">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </div>
        `:"";o.innerHTML=`
            <div class="track-info">
                <span class="track-number">${i}.</span>
                <img src="${a}" alt="${s} by ${l}" class="track-cover" 
                     onerror="this.src='/assets/default-cover.webp';" />
                <div class="track-details">
                    <strong class="track-name marquee-container">
                        <span class="track-title-inner">${w}</span>
                    </strong>
                    <small class="track-artist">${l}</small>
                </div>
            </div>
            ${c}
        `;const m=o.querySelector(".marquee-container");if(m){const u=m.querySelector(".track-title-inner");u&&u.scrollWidth>m.clientWidth&&u.classList.add("marquee")}t.appendChild(o)}),console.log(`Rendered ${e.length} tracks in container`))}window.removeTrackFromPlaylist=async function(e,t){if(confirm("X√≥a b√†i h√°t kh·ªèi playlist?"))try{const{error:n}=await y.from("playlist_tracks").delete().eq("playlist_id",t).eq("track_id",e);if(n)throw n;alert("ƒê√£ x√≥a b√†i h√°t kh·ªèi playlist!"),await window.loadDetailPlaylist(t)}catch(n){console.error("L·ªói x√≥a track:",n),alert("L·ªói: "+n.message)}};function D(e,t){if(!e||e.length===0){t.innerHTML='<p class="empty-message">Ch∆∞a c√≥ playlist n√†o.</p>';return}t.innerHTML="",e.forEach(n=>{const r=document.createElement("div");r.className="playlist-card gradient-bg",r.dataset.playlistId=n.id;const o=n.color||"#1DB954";r.style.setProperty("--card-primary-color",o),r.style.setProperty("--card-secondary-color","#282828"),r.innerHTML=`
            <div class="playlist-info">
                <h3>${h(n.name)}</h3>
                <p>${n.track_count||0} b√†i h√°t</p>
            </div>
        `,r.addEventListener("click",()=>{window.switchTab("detail-playlist",n.id)}),t.appendChild(r)})}function h(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async function j(e){try{const{data:t,error:n}=await y.from("playlists").insert([{name:e.name,color:e.color,user_id:await H(),cover_url:e.cover_url||null}]).select().single();if(n)throw n;return t}catch(t){throw console.error("L·ªói t·∫°o playlist:",t),t}}async function H(){const{data:{user:e}}=await y.auth.getUser();return e==null?void 0:e.id}window.deletePlaylist=async function(e){if(confirm("X√≥a playlist n√†y? T·∫•t c·∫£ b√†i h√°t s·∫Ω b·ªã x√≥a!"))try{const{error:t}=await y.from("playlist_tracks").delete().eq("playlist_id",e);if(t)throw t;const{error:n}=await y.from("playlists").delete().eq("id",e);if(n)throw n;alert("Playlist ƒë√£ x√≥a!"),window.switchTab("home"),window.cachedPlaylists=null,await window.appFunctions.loadUserPlaylists(!0)}catch(t){console.error("L·ªói x√≥a playlist:",t),alert("L·ªói: "+t.message)}};window.renderTracks=$;window.addTrackToPlaylist=window.addTrackToPlaylist;window.loadDetailPlaylist=window.loadDetailPlaylist;window.renderPlaylists=D;window.loadComponent=async function(e,t){const n=document.getElementById(t);if(!n){console.error(`L·ªói: Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ target ID: ${t}`);return}try{const r=await fetch(e);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const o=await r.text();n.innerHTML=o,console.log(`ƒê√£ t·∫£i th√†nh c√¥ng component: ${e}`),t==="playerBar"&&setTimeout(()=>{window.initializePlayerControls?(window.initializePlayerControls(),console.log("Player controls initialized after loading component.")):(console.warn("initializePlayerControls ch∆∞a s·∫µn s√†ng, retrying..."),setTimeout(()=>{window.initializePlayerControls&&window.initializePlayerControls()},500))},100)}catch(r){console.error(`L·ªói t·∫£i component ${e}:`,r)}};async function C(){try{const e=document.getElementById("mainContentArea"),t=document.getElementById("home-section");document.querySelectorAll(".main-section").forEach(n=>{n.style.display="none"}),t.style.display="block",await window.appFunctions.loadUserPlaylists(),await loadRecentHistory()}catch(e){console.error("L·ªói load trang ch·ªß:",e)}}window.updatePlayerBar=function(e){const t=document.getElementById("trackCover"),n=document.getElementById("trackTitle"),r=document.getElementById("trackArtist");t&&(e.cover_url&&e.cover_url.trim()!==""?(t.src=e.cover_url,t.alt=e.title||"Track cover",t.style.display="block"):(t.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRUVFRUVFIi8+CjxwYXRoIGQ9Ik0yMCAxMkMxNS41ODQgMTIgMTIgMTUuNTg0IDEyIDIwQzEyIDI0LjQxNiAxNS41ODQgMjggMjAgMjhDMjQuNDE2IDI4IDI4IDI0LjQxNiAyOCAyMEMyOCAxNS41ODQgMjQuNDE2IDEyIDIwIDEyWk0yMi41IDIxLjI1TDE5IDIzVjE3SDIyLjVWMjEuMjVaIiBmaWxsPSIjOTk5OTk5Ii8+Cjwvc3ZnPgo=",t.alt="No cover",t.style.display="block")),n&&(n.textContent=e.title||"Unknown Title"),r&&(r.textContent=e.artist||"Unknown Artist");const o=document.getElementById("sidebar-right");if(!o){console.warn("sidebar-right not found - check HTML");return}if(e?o.classList.add("active"):o.classList.remove("active"),!e){o.innerHTML=`
            <div class="right-panel-content">
                <div class="right-panel-placeholder">
                    <div class="placeholder-cover">üéµ</div>
                    <p>Ch·ªçn b√†i h√°t ƒë·ªÉ xem chi ti·∫øt</p>
                    <small>Playlist: Danh s√°ch ph√°t c√° nh√¢n</small>
                </div>
            </div>
        `;return}o.innerHTML=`
        <div class="right-panel-content">
            <div class="current-playlist-header">${window.currentPlaylistSource||"G·ª£i √Ω cho b·∫°n"}</div>
            <img src="${e.cover_url||"/assets/default-cover.webp"}" 
                 alt="${e.title} cover" 
                 class="track-cover-large" 
                 onerror="this.src='/assets/default-cover.webp'">
            <div class="track-title-large">${e.title||"Unknown Title"}</div>
            <div class="track-artist-large">${e.artist||"Unknown Artist"}</div>
            
            <div id="nextTrackContainer" class="next-track-preview"></div>
            <div id="lyricsContainer" class="lyrics-container lyrics-loading">ƒêang t·∫£i l·ªùi b√†i h√°t...</div>
        </div>
    `;const s=`
        <div id="aiChatSection" class="ai-chat-section">
            <h4>H·ªèi th√™m v·ªÅ b√†i h√°t!</h4>
            <div id="chatMessages" class="chat-messages"></div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="H·ªèi v·ªÅ ${e.title} (e.g., √ù nghƒ©a l·ªùi b√†i h√°t?)" />
                <button id="sendChatBtn" onclick="sendAIQuery('${e.id}', '${e.title}', '${e.artist}')">
                    <i class="fas fa-paper-plane"></i> G·ª≠i
                </button>
            </div>
        </div>
    `;o.insertAdjacentHTML("beforeend",s);const l=document.getElementById("chatInput");l&&l.addEventListener("keypress",a=>{a.key==="Enter"&&sendAIQuery(e.id,e.title,e.artist)}),T().then(a=>{const i=a?`
            <div class="next-track-preview">
                <h4>B√†i h√°t ti·∫øp theo</h4>
                <div class="next-track-info">${a.title} - ${a.artist}</div>
            </div>
        `:'<div class="next-track-preview"><p>Kh√¥ng c√≥ b√†i ti·∫øp theo</p></div>';document.getElementById("nextTrackContainer").innerHTML=i}),E(e),x(e)};window.sendAIQuery=async function(e,t,n){var i,w;const r=document.getElementById("chatInput"),o=document.getElementById("sendChatBtn"),s=document.getElementById("chatMessages");if(!r||!r.value.trim())return;const l=r.value.trim();r.value="",o.disabled=!0,o.innerHTML='<i class="fas fa-spinner fa-spin"></i> ƒêang h·ªèi...';const a=document.createElement("div");a.className="chat-message user",a.textContent=l,s.appendChild(a),s.scrollTop=s.scrollHeight;try{const d=window.GROQ_API_KEY;if(!d)throw new Error("GROQ_API_KEY ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh");const c=`B·∫°n l√† chuy√™n gia √¢m nh·∫°c. Tr·∫£ l·ªùi ng·∫Øn g·ªçn, h·∫•p d·∫´n v·ªÅ b√†i h√°t "${t}" c·ªßa ${n}. C√¢u h·ªèi: ${l}. Ch·ªâ tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát, d∆∞·ªõi 200 t·ª´.`,m=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({model:"llama-3.1-8b-instant",messages:[{role:"system",content:"B·∫°n l√† tr·ª£ l√Ω √¢m nh·∫°c th√¢n thi·ªán, tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát."},{role:"user",content:c}],max_tokens:300,temperature:.7})});if(!m.ok){const v=await m.text();throw console.error("Groq full error:",v),new Error(`API error: ${m.status} - ${v}`)}const u=await m.json();if(console.log("üì¶ Full Groq response:",u),!u||!u.choices||u.choices.length===0)throw new Error("No response ‚Äì check quota/key");let f=((w=(i=u.choices[0])==null?void 0:i.message)==null?void 0:w.content)||"";if(!f.trim())throw console.warn("Empty text from Groq:",u),new Error("Response empty ‚Äì check prompt/key/quota");const g=document.createElement("div");g.className="chat-message ai",g.innerHTML=f.replace(/\n/g,"<br>"),s.appendChild(g),s.scrollTop=s.scrollHeight,console.log("‚úÖ AI response for:",l)}catch(d){console.error("AI query error:",d);const c=document.createElement("div");c.className="chat-message ai",c.style.color="var(--danger-color)",c.textContent=`L·ªói: ${d.message}. Th·ª≠ l·∫°i sau!`,s.appendChild(c),s.scrollTop=s.scrollHeight}finally{o.disabled=!1,o.innerHTML='<i class="fas fa-paper-plane"></i> G·ª≠i'}};async function E(e){var o,s,l,a;const t=document.getElementById("songInfoContainer");if(!t)return;const n=new AbortController,r=setTimeout(()=>n.abort(),5e3);try{const i=encodeURIComponent(`${e.artist} ${e.title}`),w=await fetch(`https://musicbrainz.org/ws/2/recording/?query="${i}"&fmt=json&limit=1`,{signal:n.signal});if(clearTimeout(r),!w.ok)throw new Error("API fail");const d=await w.json();if(d.count>0&&d.recordings[0]){const c=d.recordings[0],m=`
                <strong>Th·ªÉ lo·∫°i:</strong> ${((o=c.genres)==null?void 0:o.map(u=>u.name).join(", "))||"Unknown"}<br>
                <strong>Ng√†y ph√°t h√†nh:</strong> ${c["first-release-date"]||"Unknown"}<br>
                <strong>M√¥ t·∫£:</strong> ${c.artist-((s=credit[0])==null?void 0:s.name)||"N/A"} - M·ªôt ca kh√∫c n·ªïi b·∫≠t t·ª´ album ${((a=(l=c.releases)==null?void 0:l[0])==null?void 0:a.title)||"N/A"}.
            `;t.innerHTML=m;return}}catch(i){clearTimeout(r),i.name==="AbortError"?console.warn("Song info timeout - fallback to mock"):console.warn("Song info fetch fail (fallback to mock):",i.message)}}async function x(e){const t=document.getElementById("lyricsContainer");if(!t)return;const n=`lyrics_${e.artist}_${e.title}`,r=localStorage.getItem(n);if(r){t.textContent=r,t.classList.remove("lyrics-loading");return}t.textContent="ƒêang t·∫£i l·ªùi b√†i h√°t...",t.classList.add("lyrics-loading");const o=new AbortController,s=setTimeout(()=>o.abort(),15e3);try{const l=encodeURIComponent(e.artist||"Unknown"),a=encodeURIComponent(e.title||"Unknown"),i=await fetch(`https://api.lyrics.ovh/v1/${l}/${a}`,{signal:o.signal});if(clearTimeout(s),!i.ok)throw new Error("No lyrics from ovh");let d=(await i.json()).lyrics||null;if(d&&d.trim()!==""){d=d.replace(/\n\s*\n/g,`

`).trim(),t.textContent=d,localStorage.setItem(n,d),t.classList.remove("lyrics-loading"),console.log("‚úÖ ovh lyrics for:",e.title);return}else throw new Error("ovh empty - fallback Genius")}catch(l){clearTimeout(s),console.warn("Lyrics.ovh failed:",l.message);try{const a="IxVXGHsLgddA9h0Po19AjKMezA4xvvKJ5uQ0CiDfpK9oFPrBXE3dr43iaeCbRlFG",i=encodeURIComponent(`${e.title} ${e.artist} lyrics`),w=`https://corsproxy.io/?${encodeURIComponent(`https://api.genius.com/search?q=${i}`)}`,d=await fetch(w);if(!d.ok)throw new Error("Proxy/Genius failed: "+d.status);const c=await d.json();if(!c.response||!c.response.hits||c.response.hits.length===0)throw new Error("No Genius match for song");const u=c.response.hits[0].result.url,f=`https://corsproxy.io/?${encodeURIComponent(u)}`,g=await fetch(f);if(!g.ok)throw new Error("Proxy lyrics failed: "+g.status);const v=await g.text(),b=new DOMParser().parseFromString(v,"text/html").querySelector(".Lyrics__Lyrics__Content");if(!b)throw new Error("Lyrics element not found");const I=b.querySelectorAll(".Lyrics__Line");let p=Array.from(I).map(k=>k.innerText.trim()).join(`
`);if(p&&p.trim()!==""){p=p.replace(/\n\s*\n/g,`

`).replace(/\[.*?\]/g,"").trim(),t.textContent=p,localStorage.setItem(n,p),t.classList.remove("lyrics-loading"),console.log("‚úÖ Genius lyrics for:",e.title);return}throw new Error("Genius lyrics empty - no more fallbacks")}catch(a){console.warn("Genius failed:",a.message);const i=`Ch∆∞a c√≥ l·ªùi cho b√†i h√°t "${e.title}" c·ªßa ${e.artist}.`;t.textContent=i,localStorage.setItem(n,i),t.classList.remove("lyrics-loading"),console.log("‚ùå No lyrics found for:",e.title)}}}async function T(){if(currentPlaylist.length===0)return null;let e=(currentTrackIndex+1)%currentPlaylist.length;if(isShuffling){let t=shuffleOrder.indexOf(currentTrackIndex);t=(t+1)%currentPlaylist.length,e=shuffleOrder[t]}return currentPlaylist[e]||null}const L=async()=>{var e;if(console.log("üîß ui.js retry check: currentUser?",!!window.currentUser,"loadHomePage?",!!window.loadHomePage,"user ID?",(e=window.currentUser)==null?void 0:e.id),!window.currentUser&&window.supabase)try{console.log("üîÑ ui.js: Force restoring user via getUser...");const{data:{user:t},error:n}=await window.supabase.auth.getUser();n?console.error("‚ùå getUser failed:",n.message):t?(window.currentUser=t,console.log("‚úÖ ui.js: Forced user restore:",t.email,t.id),window.dispatchEvent(new CustomEvent("SUPABASE_SESSION_RESTORED",{detail:{session:{user:t}}}))):console.warn("‚ö†Ô∏è getUser returned no user - check token")}catch(t){console.error("‚ùå Force getUser error:",t)}window.currentUser&&typeof window.loadHomePage=="function"?(console.log("‚úÖ ui.js: All ready - calling loadHomePage for user:",window.currentUser.id),await window.loadHomePage()):window.currentUser&&typeof C=="function"?(console.warn("‚ö†Ô∏è loadHomePage not ready - fallback to partial loadHomeContent"),await C()):(window.homeRetryCount||0)<15?(window.homeRetryCount=(window.homeRetryCount||0)+1,console.warn(`‚è≥ ui.js: Not ready (retry ${window.homeRetryCount}/15), waiting 500ms...`),setTimeout(L,500)):(console.error("‚ùå ui.js: Max retries exceeded. Manual fixes:"),console.error("- Paste `supabase.auth.getUser().then(({data:{user}})=>{window.currentUser=user; window.loadHomePage();})` in console"),console.error('- Check localStorage token: `localStorage.getItem("sb-lezswjtnlsmznkgrzgmu-auth-token")`'))};document.addEventListener("DOMContentLoaded",()=>{window.loadComponent("/components/sidebar.html","sidebar"),window.loadComponent("/components/player-bar.html","playerBar"),window.loadComponent("/home-content.html","mainContentArea"),setTimeout(L,500)});window.fetchLyrics=x;window.getNextTrackPreview=T;window.getSongInfo=E;export{j as c,D as r};
